{
  "hash": "4c2eceadf4e7f5cbdab1dc8e8574b3ee",
  "result": {
    "markdown": "---\ntitle: \"Bayesian Modeling for Psychologists, Part 2\"\ndescription: \"Mixed effects linear models, generalized linear models\"\nauthor: \"Tomer Zipori\"\ndate: last-modified\ncategories: [code, tutorial, Bayes]\nimage: \"favicon.png\"\nexecute: \n  warning: false\n  message: false\n  cache: false\nformat:\n  html:\n    theme: cosmo\n    toc: true\n    toc-depth: 3\n    toc-location: right\neditor: visual\nbibliography: Bayes102.bib\n---\n\n\n# Setup\n\nLoading some packages for demonstrations and analysis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)      # Data wrangling and plotting\nlibrary(ggdist)         # Easy and aesthetic plotting of distributions\nlibrary(ggExtra)        # Adding marginal distributions for 2d plots\nlibrary(tidybayes)      # Tidy processing of Bayesian models and extraction of MCMC chains\nlibrary(bayestestR)     # Nice plots for brms models\nlibrary(brms)           # Bayesian modeling and posterior estimation with MCMC using Stan\nlibrary(lme4)           # fitting frequentist hierarchical linear models\nlibrary(lmerTest)       # fitting frequentist hierarchical linear models\nlibrary(parameters)     # clean extraction of model parameters\nlibrary(distributional) # Plotting of theoretical distributions (for likelihood functions plots)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n# Introduction\n\nThis is the second part of \"Bayesian modeling for Psychologists\", see part 1 [here](https://tomerzipori.github.io/blog/posts/bayes101/). In this post I will show how to model some more complicated regression models, more similar to the ones you will fit in you research.\n\n# Gaussian regression\n\n## OLS Linear model\n\nIn the first part we looked at a simple linear regression model with a categorical predictor (a t-test). Let's look at linear regression with one continuous predictor:\n\n\n::: {.cell}\n\n```{.r .cell-code}\niris <- iris\n\nhead(iris)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Sepal.Length Sepal.Width Petal.Length Petal.Width Species\n1          5.1         3.5          1.4         0.2  setosa\n2          4.9         3.0          1.4         0.2  setosa\n3          4.7         3.2          1.3         0.2  setosa\n4          4.6         3.1          1.5         0.2  setosa\n5          5.0         3.6          1.4         0.2  setosa\n6          5.4         3.9          1.7         0.4  setosa\n```\n:::\n:::\n\n\nProbably some relationship between Petal width and length:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_model <- lm(Petal.Length ~ Petal.Width, data = iris)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(ols_model) |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"ngzurexirt\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ngzurexirt table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ngzurexirt thead, #ngzurexirt tbody, #ngzurexirt tfoot, #ngzurexirt tr, #ngzurexirt td, #ngzurexirt th {\n  border-style: none;\n}\n\n#ngzurexirt p {\n  margin: 0;\n  padding: 0;\n}\n\n#ngzurexirt .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ngzurexirt .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ngzurexirt .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ngzurexirt .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ngzurexirt .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ngzurexirt .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ngzurexirt .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ngzurexirt .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ngzurexirt .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ngzurexirt .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ngzurexirt .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ngzurexirt .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ngzurexirt .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ngzurexirt .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ngzurexirt .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ngzurexirt .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ngzurexirt .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ngzurexirt .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ngzurexirt .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ngzurexirt .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ngzurexirt .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ngzurexirt .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ngzurexirt .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ngzurexirt .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ngzurexirt .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ngzurexirt .gt_left {\n  text-align: left;\n}\n\n#ngzurexirt .gt_center {\n  text-align: center;\n}\n\n#ngzurexirt .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ngzurexirt .gt_font_normal {\n  font-weight: normal;\n}\n\n#ngzurexirt .gt_font_bold {\n  font-weight: bold;\n}\n\n#ngzurexirt .gt_font_italic {\n  font-style: italic;\n}\n\n#ngzurexirt .gt_super {\n  font-size: 65%;\n}\n\n#ngzurexirt .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ngzurexirt .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ngzurexirt .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ngzurexirt .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ngzurexirt .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ngzurexirt .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ngzurexirt .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"t(148)\">t(148)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.08</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.07</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.94, 1.23)</td>\n<td headers=\"t(148)\" class=\"gt_row gt_center\">14.85</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">2.23</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.05</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(2.13, 2.33)</td>\n<td headers=\"t(148)\" class=\"gt_row gt_center\">43.39</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nMaybe some interaction with species?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_model_int <- lm(Petal.Length ~ Petal.Width * Species, data = iris)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(ols_model_int) |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"kvrbcjzwwo\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#kvrbcjzwwo table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#kvrbcjzwwo thead, #kvrbcjzwwo tbody, #kvrbcjzwwo tfoot, #kvrbcjzwwo tr, #kvrbcjzwwo td, #kvrbcjzwwo th {\n  border-style: none;\n}\n\n#kvrbcjzwwo p {\n  margin: 0;\n  padding: 0;\n}\n\n#kvrbcjzwwo .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#kvrbcjzwwo .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#kvrbcjzwwo .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#kvrbcjzwwo .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#kvrbcjzwwo .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#kvrbcjzwwo .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#kvrbcjzwwo .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#kvrbcjzwwo .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#kvrbcjzwwo .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#kvrbcjzwwo .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#kvrbcjzwwo .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#kvrbcjzwwo .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#kvrbcjzwwo .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#kvrbcjzwwo .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#kvrbcjzwwo .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kvrbcjzwwo .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#kvrbcjzwwo .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#kvrbcjzwwo .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#kvrbcjzwwo .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kvrbcjzwwo .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#kvrbcjzwwo .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kvrbcjzwwo .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#kvrbcjzwwo .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kvrbcjzwwo .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kvrbcjzwwo .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kvrbcjzwwo .gt_left {\n  text-align: left;\n}\n\n#kvrbcjzwwo .gt_center {\n  text-align: center;\n}\n\n#kvrbcjzwwo .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#kvrbcjzwwo .gt_font_normal {\n  font-weight: normal;\n}\n\n#kvrbcjzwwo .gt_font_bold {\n  font-weight: bold;\n}\n\n#kvrbcjzwwo .gt_font_italic {\n  font-style: italic;\n}\n\n#kvrbcjzwwo .gt_super {\n  font-size: 65%;\n}\n\n#kvrbcjzwwo .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#kvrbcjzwwo .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#kvrbcjzwwo .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#kvrbcjzwwo .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#kvrbcjzwwo .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#kvrbcjzwwo .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#kvrbcjzwwo .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"t(144)\">t(144)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.33</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.13</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(1.07, 1.59)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">10.14</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.55</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.49</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.42, 1.52)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">1.12</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.267 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Species (versicolor)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.45</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.37</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.28, 1.19)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">1.21</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.227 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Species (virginica)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">2.91</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.41</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(2.11, 3.72)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">7.17</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width × Species (versicolor)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.32</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.56</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.23, 2.42)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">2.38</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.019 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width × Species (virginica)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.10</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.52</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.94, 1.14)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">0.19</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.848 </td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nWe get the following model:\n\n$$\nPetal.Length=1.33+0.55 \\cdot Petal.Width+0.45 \\cdot SpeciesVersicolor+2.91 \\cdot SpeciesVirginica+1.32 \\cdot Petal.Width \\cdot SpeciesVersicolor+0.1 \\cdot Petal.Width \\cdot SpeciesVirginica\n$$\n\nIn order for the intercept to have practical meaning we need to center the predictor `Petal.Width`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\niris$Petal.Width_c <- scale(iris$Petal.Width, scale = FALSE)[,1]\n```\n:::\n\n\nFitting the model again:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_model_centered <- lm(Petal.Length ~ Petal.Width_c * Species, data = iris)\n```\n:::\n\n\nNow the intercept will be the predicted `Petal.Length` for Setosa flowers with mean `Petal.Width`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(ols_model_centered) |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"vdpwulkuye\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#vdpwulkuye table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#vdpwulkuye thead, #vdpwulkuye tbody, #vdpwulkuye tfoot, #vdpwulkuye tr, #vdpwulkuye td, #vdpwulkuye th {\n  border-style: none;\n}\n\n#vdpwulkuye p {\n  margin: 0;\n  padding: 0;\n}\n\n#vdpwulkuye .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#vdpwulkuye .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#vdpwulkuye .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#vdpwulkuye .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#vdpwulkuye .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#vdpwulkuye .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#vdpwulkuye .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#vdpwulkuye .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#vdpwulkuye .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#vdpwulkuye .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#vdpwulkuye .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vdpwulkuye .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#vdpwulkuye .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#vdpwulkuye .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#vdpwulkuye .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vdpwulkuye .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#vdpwulkuye .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#vdpwulkuye .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#vdpwulkuye .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vdpwulkuye .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#vdpwulkuye .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vdpwulkuye .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#vdpwulkuye .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vdpwulkuye .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vdpwulkuye .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vdpwulkuye .gt_left {\n  text-align: left;\n}\n\n#vdpwulkuye .gt_center {\n  text-align: center;\n}\n\n#vdpwulkuye .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#vdpwulkuye .gt_font_normal {\n  font-weight: normal;\n}\n\n#vdpwulkuye .gt_font_bold {\n  font-weight: bold;\n}\n\n#vdpwulkuye .gt_font_italic {\n  font-style: italic;\n}\n\n#vdpwulkuye .gt_super {\n  font-size: 65%;\n}\n\n#vdpwulkuye .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#vdpwulkuye .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#vdpwulkuye .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#vdpwulkuye .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#vdpwulkuye .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#vdpwulkuye .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#vdpwulkuye .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"t(144)\">t(144)</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.98</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.47</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(1.05, 2.91)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">4.22</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width c</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.55</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.49</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.42, 1.52)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">1.12</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.267 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Species (versicolor)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">2.04</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.47</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(1.10, 2.98)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">4.31</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Species (virginica)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">3.03</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.50</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(2.05, 4.02)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">6.10</td>\n<td headers=\"p\" class=\"gt_row gt_center\">&lt; .001</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width c × Species (versicolor)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.32</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.56</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.23, 2.42)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">2.38</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.019 </td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal Width c × Species (virginica)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.10</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.52</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.94, 1.14)</td>\n<td headers=\"t(144)\" class=\"gt_row gt_center\">0.19</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.848 </td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nThe model is:\n\n$$\nPetal.Length=1.98+0.55 \\cdot Petal.Width+2.04 \\cdot SpeciesVersicolor+3.03 \\cdot SpeciesVirginica+1.32 \\cdot Petal.Width \\cdot SpeciesVersicolor+0.1 \\cdot Petal.Width \\cdot SpeciesVirginica\n$$\n\n### Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf_plot <- iris |>\n  ggplot(aes(x = Petal.Width, y = Petal.Length, color = Species, fill = Species)) +\n  geom_point(show.legend = F) +\n  geom_smooth(method = \"lm\") +\n  scale_fill_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_color_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  blog_theme\n\nf_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## Bayesian linear model\n\nIn order to fit the same model in a Bayesian way, we will first need to define the prior distribution. In this case there are a total of 7 parameters.\n\nLet's verify this with the `get_prior()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_prior(formula = Petal.Length ~ Petal.Width_c * Species,\n          data = iris,\n          family = gaussian())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  prior     class                            coef group resp\n                 (flat)         b                                           \n                 (flat)         b                   Petal.Width_c           \n                 (flat)         b Petal.Width_c:Speciesversicolor           \n                 (flat)         b  Petal.Width_c:Speciesvirginica           \n                 (flat)         b               Speciesversicolor           \n                 (flat)         b                Speciesvirginica           \n student_t(3, 4.3, 2.5) Intercept                                           \n   student_t(3, 0, 2.5)     sigma                                           \n dpar nlpar lb ub       source\n                       default\n                  (vectorized)\n                  (vectorized)\n                  (vectorized)\n                  (vectorized)\n                  (vectorized)\n                       default\n             0         default\n```\n:::\n:::\n\n\nI will model some positive relationship between *length* and *width*, a relatively weakly-informed prior on the intercept, and a very wide prior on the not-interesting sigma parameter. On the other parameters I will have an \"agnostic\" zero-centered Normal distribution:\n\n::: column-margin\n#### student-t prior\n\nThe student-t distribution is symmetrical like the Gaussian distribution, but it has thicker \"tails\". This allows the model to explore wider area of the possible parameter value space.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_iris <- set_prior(\"normal(1, 3)\", coef = \"Petal.Width_c\") +\n  set_prior(\"normal(0, 3)\", coef = \"Speciesversicolor\") +\n  set_prior(\"normal(0, 3)\", coef = \"Speciesvirginica\") +\n  set_prior(\"normal(0, 3)\", coef = \"Petal.Width_c:Speciesversicolor\") +\n  set_prior(\"normal(0, 3)\", coef = \"Petal.Width_c:Speciesvirginica\") +\n  set_prior(\"normal(0, 3)\", class = \"Intercept\") +\n  set_prior(\"exponential(0.001)\", class = \"sigma\")\n```\n:::\n\n\n::: column-margin\n#### Exponential prior\n\nBecause variances are strictly positive, the exponential distribution is a common choice for it (and other variance parameters):\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n:::\n\nFitting a model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_model_iris <- brm(Petal.Length ~ Petal.Width_c * Species,\n                        data = iris,\n                        family = gaussian(),\n                        prior = prior_iris,\n                        cores = 4,\n                        chains = 4,\n                        iter = 4000,\n                        backend = \"cmdstanr\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(bayes_model_iris, centrality = \"all\") |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"gmbrmqmovn\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#gmbrmqmovn table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#gmbrmqmovn thead, #gmbrmqmovn tbody, #gmbrmqmovn tfoot, #gmbrmqmovn tr, #gmbrmqmovn td, #gmbrmqmovn th {\n  border-style: none;\n}\n\n#gmbrmqmovn p {\n  margin: 0;\n  padding: 0;\n}\n\n#gmbrmqmovn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#gmbrmqmovn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#gmbrmqmovn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#gmbrmqmovn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#gmbrmqmovn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#gmbrmqmovn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#gmbrmqmovn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#gmbrmqmovn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#gmbrmqmovn .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#gmbrmqmovn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#gmbrmqmovn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#gmbrmqmovn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#gmbrmqmovn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#gmbrmqmovn .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#gmbrmqmovn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#gmbrmqmovn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#gmbrmqmovn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#gmbrmqmovn .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#gmbrmqmovn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#gmbrmqmovn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#gmbrmqmovn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#gmbrmqmovn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#gmbrmqmovn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#gmbrmqmovn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#gmbrmqmovn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#gmbrmqmovn .gt_left {\n  text-align: left;\n}\n\n#gmbrmqmovn .gt_center {\n  text-align: center;\n}\n\n#gmbrmqmovn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#gmbrmqmovn .gt_font_normal {\n  font-weight: normal;\n}\n\n#gmbrmqmovn .gt_font_bold {\n  font-weight: bold;\n}\n\n#gmbrmqmovn .gt_font_italic {\n  font-style: italic;\n}\n\n#gmbrmqmovn .gt_super {\n  font-size: 65%;\n}\n\n#gmbrmqmovn .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#gmbrmqmovn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#gmbrmqmovn .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#gmbrmqmovn .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#gmbrmqmovn .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#gmbrmqmovn .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#gmbrmqmovn .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"8\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Model Summary</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Median\">Median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Mean\">Mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"MAP\">MAP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pd\">pd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Rhat\">Rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ESS\">ESS</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Fixed Effects \">Fixed Effects </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">2.14</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">2.14</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">2.15</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(1.24, 3.04)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1473.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal.Width_c</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">0.71</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">0.71</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">0.71</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(-0.22, 1.65)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">93.39%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1466.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Speciesversicolor</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">1.89</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">1.88</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">1.90</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(0.98, 2.79)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1507.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Speciesvirginica</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">2.87</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">2.87</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">2.85</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(1.92, 3.81)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1676.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal.Width_c:Speciesversicolor</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">1.16</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">1.16</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">1.16</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(0.11, 2.22)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">98.38%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1712.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Petal.Width_c:Speciesvirginica</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">-0.05</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">-0.05</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">-0.04</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(-1.07, 0.97)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">54.23%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1618.00</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Sigma \">Sigma </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Sigma   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">sigma</td>\n<td headers=\"Sigma   Median\" class=\"gt_row gt_center\">0.36</td>\n<td headers=\"Sigma   Mean\" class=\"gt_row gt_center\">0.36</td>\n<td headers=\"Sigma   MAP\" class=\"gt_row gt_center\">0.36</td>\n<td headers=\"Sigma   95% CI\" class=\"gt_row gt_center\">(0.32, 0.41)</td>\n<td headers=\"Sigma   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Sigma   Rhat\" class=\"gt_row gt_center\">1.001</td>\n<td headers=\"Sigma   ESS\" class=\"gt_row gt_center\">3753.00</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"8\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(ols_model_centered)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nParameter                            | Coefficient |   SE |        95% CI | t(144) |      p\n-------------------------------------------------------------------------------------------\n(Intercept)                          |        1.98 | 0.47 | [ 1.05, 2.91] |   4.22 | < .001\nPetal Width c                        |        0.55 | 0.49 | [-0.42, 1.52] |   1.12 | 0.267 \nSpecies [versicolor]                 |        2.04 | 0.47 | [ 1.10, 2.98] |   4.31 | < .001\nSpecies [virginica]                  |        3.03 | 0.50 | [ 2.05, 4.02] |   6.10 | < .001\nPetal Width c × Species [versicolor] |        1.32 | 0.56 | [ 0.23, 2.42] |   2.38 | 0.019 \nPetal Width c × Species [virginica]  |        0.10 | 0.52 | [-0.94, 1.14] |   0.19 | 0.848 \n```\n:::\n:::\n\n\nConvergence metrics looking good, we can proceed to interpret the posterior.\n\n### Visualization\n\nVisualizing a Bayesian regression model can be done in several ways:\n\n#### Visualizing regression parameters themselves\n\nLike we saw in Part 1, we can directly inspect the marginal posteriors of the coefficients themselves. First we will extract them into a data.frame (and rename interaction terms for convenience):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_iris <- spread_draws(bayes_model_iris, b_Intercept, b_Petal.Width_c, b_Speciesversicolor, b_Speciesvirginica, !!sym(\"b_Petal.Width_c:Speciesversicolor\"), !!sym(\"b_Petal.Width_c:Speciesvirginica\"), sigma) |>\n  rename(b_Petal.WidthXSpeciesversicolor = !!sym(\"b_Petal.Width_c:Speciesversicolor\"),\n         b_Petal.WidthXSpeciesvirginica = !!sym(\"b_Petal.Width_c:Speciesvirginica\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(posterior_iris)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 10\n  .chain .iteration .draw b_Intercept b_Petal.Width_c b_Speciesversicolor\n   <int>      <int> <int>       <dbl>           <dbl>               <dbl>\n1      1          1     1        1.82           0.393                2.18\n2      1          2     2        1.56           0.160                2.39\n3      1          3     3        1.61           0.102                2.34\n4      1          4     4        1.69           0.231                2.30\n5      1          5     5        1.67           0.243                2.29\n6      1          6     6        1.71           0.250                2.26\n# ℹ 4 more variables: b_Speciesvirginica <dbl>,\n#   b_Petal.WidthXSpeciesversicolor <dbl>,\n#   b_Petal.WidthXSpeciesvirginica <dbl>, sigma <dbl>\n```\n:::\n:::\n\n\nIn the output of `spread_draws` we get 10 columns:\\\n\\* *.chain* = the index of the MCMC chain (4 total in our case).\\\n\\* *.iteration* = the index of the draw within it's chain (each chain is 500 samples long).\\\n\\* *.draw* = the overall index of the draw (2000 samples in the posterior overall).\\\n\\* *parameter_name* - draw's value for each parameter.\\\n\nPlotting the marginal posteriors:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_iris |>\n  pivot_longer(cols = c(b_Intercept, b_Petal.Width_c, b_Speciesversicolor, b_Speciesvirginica, b_Petal.WidthXSpeciesversicolor, b_Petal.WidthXSpeciesvirginica),\n               names_to = \"variable\") |>\n  ggplot(aes(x = value, y = variable, fill = after_stat(x > 0))) +\n  stat_halfeye() +\n  geom_vline(xintercept = 0, linetype = \"dashed\") +\n  scale_fill_manual(values = c(\"#d1495b\", \"#00798c\"), labels = c(\"Negative\", \"Positive\")) +\n  scale_x_continuous(breaks = seq(-4, 4, 0.5), labels = seq(-4, 4, 0.5)) +\n  labs(fill = \"Direction of Effect\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n#### Visualizing the regression line(s)\n\nMarginal posteriors are nice, but are not a visualization of the model itself. Like in the frequentist model, we would like to see the regression line itself. How to do it?\n\nThe regression line is a line of conditional means:\n\n$$\n\\mu|X=\\beta X\n$$/\n\nBut, we have 4000 samples from the posterior containing possible values for each parameter $\\beta_i$ - a.k.a a distribution. So for each possible row in the data set we will have a distribution (4000 values) of predicted conditional means $\\mu|X$:\n\n::: column-margin\n#### Uncertainty\n\nWhy not summarizing the MCMC chains when inferring or visualizing a Bayesian model?\n\nA key aspect of statistical modeling and visualization is the measurement of uncertainty in the data. In the frequentist world, this is represented with standard errors and confidence intervals.\n\nIn the Bayesian world uncertainty is represented by the MCMC samples themselves, creating the posterior distribution. For that reason we will make calculations and visualizations with the MCMC samples and not with their summaries.\n:::\n\nCreating a data.frame of independent variables (a design matrix) for creating predictions from the posterior:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data <- expand_grid(Petal.Width_c = seq(min(iris$Petal.Width_c), max(iris$Petal.Width_c), length=200),\n                        Species = unique(iris$Species))\n\nhead(new_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  Petal.Width_c Species   \n          <dbl> <fct>     \n1         -1.10 setosa    \n2         -1.10 versicolor\n3         -1.10 virginica \n4         -1.09 setosa    \n5         -1.09 versicolor\n6         -1.09 virginica \n```\n:::\n:::\n\n\nWe actually need to remove some rows from this data frame. This is because not all values of *Petal.Width* appear in all species. The range of observed widths is different between different species.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrange_setosa <- c(min(iris$Petal.Width_c[iris$Species == \"setosa\"]), max(iris$Petal.Width_c[iris$Species == \"setosa\"]))\nrange_versicolor <- c(min(iris$Petal.Width_c[iris$Species == \"versicolor\"]), max(iris$Petal.Width_c[iris$Species == \"versicolor\"]))\nrange_virginica <- c(min(iris$Petal.Width_c[iris$Species == \"virginica\"]), max(iris$Petal.Width_c[iris$Species == \"virginica\"]))\n\n\nnew_data <- new_data |>\n  mutate(extrapolation = case_when((Species == \"setosa\" & Petal.Width_c < range_setosa[1]) | (Species == \"setosa\" & Petal.Width_c > range_setosa[2]) ~ TRUE,\n                                   (Species == \"versicolor\" & Petal.Width_c < range_versicolor[1]) | (Species == \"versicolor\" & Petal.Width_c > range_versicolor[2]) ~ TRUE,\n                                   (Species == \"virginica\" & Petal.Width_c < range_virginica[1]) | (Species == \"virginica\" & Petal.Width_c > range_virginica[2]) ~ TRUE,\n                                   .default = FALSE)) |>\n  filter(!extrapolation)\n```\n:::\n\n\nCalculating the distribution of conditional means for the second row: $Petal.Widthc=-1.099333; \\ Species=versicolor$:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_iris |>\n  mutate(conditional_mean = b_Intercept + b_Petal.Width_c * -1.099333 + b_Speciesversicolor + b_Petal.WidthXSpeciesversicolor * -1.099333) |>\n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 11\n  .chain .iteration .draw b_Intercept b_Petal.Width_c b_Speciesversicolor\n   <int>      <int> <int>       <dbl>           <dbl>               <dbl>\n1      1          1     1        1.82           0.393                2.18\n2      1          2     2        1.56           0.160                2.39\n3      1          3     3        1.61           0.102                2.34\n4      1          4     4        1.69           0.231                2.30\n5      1          5     5        1.67           0.243                2.29\n6      1          6     6        1.71           0.250                2.26\n# ℹ 5 more variables: b_Speciesvirginica <dbl>,\n#   b_Petal.WidthXSpeciesversicolor <dbl>,\n#   b_Petal.WidthXSpeciesvirginica <dbl>, sigma <dbl>, conditional_mean <dbl>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_iris |>\n  mutate(conditional_mean = b_Intercept + b_Petal.Width_c * -1.099333 + b_Speciesversicolor + b_Petal.WidthXSpeciesversicolor * -1.099333) |>\n  ggplot(aes(y = conditional_mean)) +\n  stat_slab(fill = \"#d1495b\", color = \"gray34\") +\n  labs(y = expression(mu)) +\n  blog_theme +\n  theme(axis.title.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.ticks.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\nCalculating this for several rows gives us several more distributions of conditional means. I here use values realistic for each species to avoid extrapolation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwidth_values_setosa <- c(-1, -0.9, -0.7)\nwidth_values_versicolor <- c(0, 0.1, 0.3)\nwidth_values_virginica <- c(0.2, 0.8, 1.1)\n\nposterior_iris |>\n  mutate(conditionalmean_1_setosa = b_Intercept + b_Petal.Width_c * width_values_setosa[1],\n         conditionalmean_2_setosa = b_Intercept + b_Petal.Width_c * width_values_setosa[2],\n         conditionalmean_3_setosa = b_Intercept + b_Petal.Width_c * width_values_setosa[3],\n         conditionalmean_1_versicolor = b_Intercept + b_Petal.Width_c * width_values_versicolor[1] + b_Speciesversicolor + b_Petal.WidthXSpeciesversicolor * width_values_versicolor[1],\n         conditionalmean_2_versicolor = b_Intercept + b_Petal.Width_c * width_values_versicolor[2] + b_Speciesversicolor + b_Petal.WidthXSpeciesversicolor * width_values_versicolor[2],\n         conditionalmean_3_versicolor = b_Intercept + b_Petal.Width_c * width_values_versicolor[3] + b_Speciesversicolor + b_Petal.WidthXSpeciesversicolor * width_values_versicolor[3],\n         conditionalmean_1_virginica = b_Intercept + b_Petal.Width_c * width_values_virginica[1] + b_Speciesvirginica + b_Petal.WidthXSpeciesvirginica * width_values_virginica[1],\n         conditionalmean_2_virginica = b_Intercept + b_Petal.Width_c * width_values_virginica[2] + b_Speciesvirginica + b_Petal.WidthXSpeciesvirginica * width_values_virginica[2],\n         conditionalmean_3_virginica = b_Intercept + b_Petal.Width_c * width_values_virginica[3] + b_Speciesvirginica + b_Petal.WidthXSpeciesvirginica * width_values_virginica[3]) |>\n  pivot_longer(cols = c(conditionalmean_1_setosa, conditionalmean_2_setosa, conditionalmean_3_setosa,\n                        conditionalmean_1_versicolor, conditionalmean_2_versicolor, conditionalmean_3_versicolor,\n                        conditionalmean_1_virginica, conditionalmean_2_virginica, conditionalmean_3_virginica),\n               names_to = c(\"junk\", \"index\", \"Species\"),\n               names_sep = \"_\") |>\n  mutate(index = case_when(index == 1 & Species == \"setosa\" ~ width_values_setosa[1],\n                           index == 2 & Species == \"setosa\" ~ width_values_setosa[2],\n                           index == 3 & Species == \"setosa\" ~ width_values_setosa[3],\n                           index == 1 & Species == \"versicolor\" ~ width_values_versicolor[1],\n                           index == 2 & Species == \"versicolor\" ~ width_values_versicolor[2],\n                           index == 3 & Species == \"versicolor\" ~ width_values_versicolor[3],\n                           index == 1 & Species == \"virginica\" ~ width_values_virginica[1],\n                           index == 2 & Species == \"virginica\" ~ width_values_virginica[2],\n                           index == 3 & Species == \"virginica\" ~ width_values_virginica[3])) |>\n  ggplot(aes(x = index, y = value, fill = Species)) +\n    stat_slab(color = \"gray33\", linewidth = 0.5) +\n    scale_fill_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n    labs(x = \"Petal.Width\", y = expression(mu)) +\n    blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\nWe can use the `add_linpred_draws()` function from the awesome `tidybayes` package [@kay_tidybayes_2020] in order to do this thing for all values of X, and finally plot the regression line with the credible interval around it:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data |>\n  add_linpred_draws(bayes_model_iris) |>\n  ggplot(aes(x = Petal.Width_c, y = .linpred, fill = Species, color = Species)) +\n  geom_point(data = iris, aes(y = Petal.Length, color = Species), show.legend = F) +\n  stat_lineribbon(.width = c(0.80, 0.85, 0.97), alpha = 0.7) +\n  scale_fill_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_color_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  labs(y = expression(mu), fill = \"Species\", title = \"80%, 85% and 97% Credible Intervals\") +\n  guides(color = \"none\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\nThis is similar to the frequentist confidence interval, just remember that these interval **actually** represents 80%, 85%, and 97% of regression lines.\n\nI think that a better way of visualizing uncertainty is by plotting the individual line themselves. Each draw represents a different regression line, plotting them all will give a nice uncertainty visualization:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data <- new_data |>\n  select(-extrapolation) |>\n  add_linpred_draws(bayes_model_iris, ndraws = 44, seed = 14)\n```\n:::\n\n\nWe can look at individual draws:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data |>\n  filter(.draw == 14) |>\n  ggplot(aes(x = Petal.Width_c, y = .linpred, color = Species)) +\n  geom_line(linewidth = 1) +\n  geom_point(data = iris, aes(x = Petal.Width_c, y = Petal.Length, color = Species), inherit.aes = F, show.legend = F) +\n  scale_color_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  labs(y = \"Petal.Length\", title = \"Draw number 14\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\nOr we can group by draw index and look at all the lines:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data |>\n  ggplot(aes(x = Petal.Width_c, y = .linpred, group = interaction(.draw, Species), color = Species)) +\n  geom_point(data = iris, aes(x = Petal.Width_c, y = Petal.Length, color = Species), inherit.aes = F, show.legend = F) +\n  geom_line(alpha = 0.4) +\n  scale_fill_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_color_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  labs(y = \"Petal.Length\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n# Hierarchical Linear Models (Mixed Effects Linear Models)\n\nHierarchical linear regression models, or Mixed effects linear models are very popular in Psychology due to the fact that data in the field tends to be hierarchical (e.g. repeated measures of participants, participants nested in some larger groups, etc...). Because this post is already quite long, I will assume you have some knowledge about hierarchical structure, fixed and random effects and model estimation.\\\n\nLuckily for us, `brms` is more then capable at estimating mixed effects models. It even has the `lme4`/`nlme` syntax in the logo!\n\n![the effect of r on b with random slopes of m to each grouping variable s???](../bayes102/brms.png){.lightbox fig-align=\"center\" width=\"100\"}\n\nLet's look at the classic `sleepstudy` dataset containing \"*The average reaction time per day (in milliseconds) for subjects in a sleep deprivation study*\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsleep <- sleepstudy\n\nglimpse(sleep)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 180\nColumns: 3\n$ Reaction <dbl> 249.5600, 258.7047, 250.8006, 321.4398, 356.8519, 414.6901, 3…\n$ Days     <dbl> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0…\n$ Subject  <fct> 308, 308, 308, 308, 308, 308, 308, 308, 308, 308, 309, 309, 3…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsleep |>\n  ggplot(aes(x = Days, y = Reaction)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", fill = \"#d1495b\", color = \"#5D001E\") +\n  scale_x_continuous(breaks = seq(0, 9, 1), labels = seq(0, 9, 1)) +\n  facet_wrap(~Subject) +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\nFull model for predicting reaction time can be:\n\n$$\nReactionTime \\sim N(\\mu, \\sigma^2)\n$$\n\nAnd:\n\nLevel 1: Reaction time of subject $i$ in day $j$ is:/ $$\nRT_{ij}=\\beta_{0i}+\\beta_{1i} \\cdot Days_j +e_{ij}\n$$\n\nLevel 2 (random offset of coefficients for subject):/ $$\n\\beta_{0i}=\\gamma_{00}+\\tau_{0i}\n$$\n\n$$\n\\beta_{1i}=\\gamma_{10}+\\tau_{1i}\n$$\n\nWhere:\n\n$$\n\\begin{bmatrix}\n      \\beta_0 \\cr\n      \\beta_1\n\\end{bmatrix} \\sim MVN(\\begin{bmatrix}\n                       \\gamma_{00} \\cr\n                       \\gamma_{10}\n                       \\end{bmatrix},\\begin{bmatrix}\n                                      \\tau_0^2 & \\tau_0\\tau_1\\rho_{01} \\cr\n                                      \\tau_1\\tau_0\\rho_{01} & \\tau_1^2\n                                      \\end{bmatrix})\n$$\n\nAnd $\\rho_{01}$ is the correlation coefficient between random intercepts and slopes.\n\n## Maximum Likelihood Estimation\n\nFitting this model with the frequentist ML method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsleep_model_ml <- lmer(Reaction ~ 1 + Days + (1 + Days | Subject),\n                       data = sleep)\n```\n:::\n\n\nUsing the `sjPlot::tab_model()` function to produce a nice summarized statistics of mixed models:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsjPlot::tab_model(sleep_model_ml)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">Reaction</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">(Intercept)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">251.41</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">237.94&nbsp;&ndash;&nbsp;264.87</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Days</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">10.47</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">7.42&nbsp;&ndash;&nbsp;13.52</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"font-weight:bold; text-align:left; padding-top:.8em;\">Random Effects</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&sigma;<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">654.94</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>00</sub> <sub>Subject</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">612.10</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>11</sub> <sub>Subject.Days</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">35.07</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&rho;<sub>01</sub> <sub>Subject</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.07</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">ICC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.72</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">N <sub>Subject</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">18</td>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">180</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">Marginal R<sup>2</sup> / Conditional R<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.279 / 0.799</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n## Bayesian Estimation\n\nHow many parameters? we have 2 fixed effects (intercept and slope), 3 random effects (random intercept, random slope and their correlation), and sigma - A total of 6 parameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_prior(formula = Reaction ~ 1 + Days + (1 + Days | Subject),\n          data = sleep,\n          family = gaussian())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     prior     class      coef   group resp dpar nlpar lb ub\n                    (flat)         b                                        \n                    (flat)         b      Days                              \n                    lkj(1)       cor                                        \n                    lkj(1)       cor           Subject                      \n student_t(3, 288.7, 59.3) Intercept                                        \n     student_t(3, 0, 59.3)        sd                                    0   \n     student_t(3, 0, 59.3)        sd           Subject                  0   \n     student_t(3, 0, 59.3)        sd      Days Subject                  0   \n     student_t(3, 0, 59.3)        sd Intercept Subject                  0   \n     student_t(3, 0, 59.3)     sigma                                    0   \n       source\n      default\n (vectorized)\n      default\n (vectorized)\n      default\n      default\n (vectorized)\n (vectorized)\n (vectorized)\n      default\n```\n:::\n:::\n\n\n### Prior elicitation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_sleep <- set_prior(\"normal(10, 4)\", coef = \"Days\") + # RT should increase with continued sleep deprivation\n  set_prior(\"exponential(1)\", class = \"sd\") + # setting a prior on all random variances at once\n  set_prior(\"exponential(0.01)\", class = \"sigma\")\n```\n:::\n\n\n### Model estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_model_sleep <- brm(formula = Reaction ~ 1 + Days + (1 + Days | Subject),\n                         data = sleep,\n                         family = gaussian(),\n                         prior = prior_sleep,\n                         chains = 4,\n                         cores = 4,\n                         iter = 2000,\n                         backend = \"cmdstanr\")\n```\n:::\n\n\nAs our models get more complicated, the posterior distribution gets more hard for the MCMC sampler to sample from. That can result in low ECC and/or high Rhat. One solution can be simply increasing the length of each MCMC chain! this change to model definition doesn't require compiling the *Stan* code again, use the `update()` function instead:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_model_sleep <- update(bayes_model_sleep, iter = 9000)\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(bayes_model_sleep, centrality = \"all\", effects = \"all\") |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"lnovdrbdcn\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#lnovdrbdcn table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#lnovdrbdcn thead, #lnovdrbdcn tbody, #lnovdrbdcn tfoot, #lnovdrbdcn tr, #lnovdrbdcn td, #lnovdrbdcn th {\n  border-style: none;\n}\n\n#lnovdrbdcn p {\n  margin: 0;\n  padding: 0;\n}\n\n#lnovdrbdcn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#lnovdrbdcn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#lnovdrbdcn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#lnovdrbdcn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#lnovdrbdcn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#lnovdrbdcn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#lnovdrbdcn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#lnovdrbdcn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#lnovdrbdcn .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#lnovdrbdcn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#lnovdrbdcn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#lnovdrbdcn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#lnovdrbdcn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#lnovdrbdcn .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#lnovdrbdcn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lnovdrbdcn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#lnovdrbdcn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#lnovdrbdcn .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#lnovdrbdcn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lnovdrbdcn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#lnovdrbdcn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lnovdrbdcn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#lnovdrbdcn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lnovdrbdcn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lnovdrbdcn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lnovdrbdcn .gt_left {\n  text-align: left;\n}\n\n#lnovdrbdcn .gt_center {\n  text-align: center;\n}\n\n#lnovdrbdcn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#lnovdrbdcn .gt_font_normal {\n  font-weight: normal;\n}\n\n#lnovdrbdcn .gt_font_bold {\n  font-weight: bold;\n}\n\n#lnovdrbdcn .gt_font_italic {\n  font-style: italic;\n}\n\n#lnovdrbdcn .gt_super {\n  font-size: 65%;\n}\n\n#lnovdrbdcn .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#lnovdrbdcn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#lnovdrbdcn .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#lnovdrbdcn .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#lnovdrbdcn .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#lnovdrbdcn .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#lnovdrbdcn .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"8\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Model Summary</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Median\">Median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Mean\">Mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"MAP\">MAP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pd\">pd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Rhat\">Rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ESS\">ESS</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Fixed Effects \">Fixed Effects </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">251.44</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">251.44</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">251.58</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(243.45, 259.61)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">18190.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Days</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">10.38</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">10.37</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">10.47</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(7.53, 13.22)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">12965.00</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Sigma \">Sigma </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Sigma   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">sigma</td>\n<td headers=\"Sigma   Median\" class=\"gt_row gt_center\">28.66</td>\n<td headers=\"Sigma   Mean\" class=\"gt_row gt_center\">28.72</td>\n<td headers=\"Sigma   MAP\" class=\"gt_row gt_center\">28.59</td>\n<td headers=\"Sigma   95% CI\" class=\"gt_row gt_center\">(25.51, 32.32)</td>\n<td headers=\"Sigma   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Sigma   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Sigma   ESS\" class=\"gt_row gt_center\">14323.00</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Random Effects Variances \">Random Effects Variances </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Random Effects Variances   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">SD (Intercept: Subject)</td>\n<td headers=\"Random Effects Variances   Median\" class=\"gt_row gt_center\">2.58</td>\n<td headers=\"Random Effects Variances   Mean\" class=\"gt_row gt_center\">3.57</td>\n<td headers=\"Random Effects Variances   MAP\" class=\"gt_row gt_center\">0.16</td>\n<td headers=\"Random Effects Variances   95% CI\" class=\"gt_row gt_center\">(0.06, 11.71)</td>\n<td headers=\"Random Effects Variances   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Random Effects Variances   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Random Effects Variances   ESS\" class=\"gt_row gt_center\">4650.00</td></tr>\n    <tr><td headers=\"Random Effects Variances   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">SD (Days: Subject)</td>\n<td headers=\"Random Effects Variances   Median\" class=\"gt_row gt_center\">5.75</td>\n<td headers=\"Random Effects Variances   Mean\" class=\"gt_row gt_center\">5.82</td>\n<td headers=\"Random Effects Variances   MAP\" class=\"gt_row gt_center\">5.64</td>\n<td headers=\"Random Effects Variances   95% CI\" class=\"gt_row gt_center\">(3.94, 8.08)</td>\n<td headers=\"Random Effects Variances   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Random Effects Variances   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Random Effects Variances   ESS\" class=\"gt_row gt_center\">6902.00</td></tr>\n    <tr><td headers=\"Random Effects Variances   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Cor (Intercept~Days: Subject)</td>\n<td headers=\"Random Effects Variances   Median\" class=\"gt_row gt_center\">0.59</td>\n<td headers=\"Random Effects Variances   Mean\" class=\"gt_row gt_center\">0.46</td>\n<td headers=\"Random Effects Variances   MAP\" class=\"gt_row gt_center\">0.96</td>\n<td headers=\"Random Effects Variances   95% CI\" class=\"gt_row gt_center\">(-0.74, 0.98)</td>\n<td headers=\"Random Effects Variances   pd\" class=\"gt_row gt_center\">84.40%</td>\n<td headers=\"Random Effects Variances   Rhat\" class=\"gt_row gt_center\">1.001</td>\n<td headers=\"Random Effects Variances   ESS\" class=\"gt_row gt_center\">1453.00</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"8\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nExtracting MCMC draws:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_sleep <- spread_draws(bayes_model_sleep, b_Intercept, b_Days, sd_Subject__Intercept, sd_Subject__Days, cor_Subject__Intercept__Days)\n```\n:::\n\n\n#### The parameters themselves\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_sleep |>\n  ggplot(aes(x = b_Intercept, fill = \"#d1495b\")) +\n  stat_slab(color = \"gray34\") +\n  guides(color = \"none\", fill = \"none\") +\n  labs(title = \"Intercept\", y = NULL, x = NULL) +\n  scale_x_continuous(breaks = seq(230, 270, 5), labels = seq(230, 270, 5)) +\n  blog_theme +\n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_sleep |>\n  ggplot(aes(x = b_Days, fill = \"#d1495b\")) +\n  stat_slab(color = \"gray34\") +\n  guides(color = \"none\", fill = \"none\") +\n  labs(title = \"b_Days\", y = NULL, x = NULL) +\n  scale_x_continuous(breaks = seq(5, 17, 1), labels = seq(5, 17, 1)) +\n  blog_theme +\n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_sleep |>\n  select(.draw, sd_Subject__Intercept, sd_Subject__Days) |>\n  pivot_longer(cols = c(sd_Subject__Intercept, sd_Subject__Days),\n               names_to = \"variable\") |>\n  ggplot(aes(x = value, y = variable)) +\n  stat_slab(fill = \"#d1495b\", color = \"gray34\") +\n  scale_x_continuous(breaks = seq(0, 24, 2), labels = seq(0, 24, 2)) +\n  labs(title = \"SD of random effects\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\nThese are actually the error terms of the random effects. We saw that they should be correlated:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_sleep |>\n  ggplot(aes(x = cor_Subject__Intercept__Days, fill = after_stat(x < 0))) +\n  stat_halfeye() +\n  geom_vline(xintercept = 0, linetype = \"dashed\") +\n  scale_fill_manual(values = c(\"#d1495b\", \"#00798c\"), labels = c(\"Negative\", \"Positive\")) +\n  scale_x_continuous(breaks = seq(-1, 1, 0.25), labels = seq(-1, 1, 0.25)) +\n  labs(title = \"Correlation between random effects\", fill = \"Direction of Correlation\", y = NULL, x = expression(r)) +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np_direction(bayes_model_sleep, effects = \"random\", parameters = \"cor*\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nProbability of Direction SD/Cor: Subject\n\nParameter        |     pd\n-------------------------\nIntercept ~ Days | 84.40%\n```\n:::\n:::\n\n\n#### The line\n\nGenerating an empty design matrix:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sleep <- expand_grid(Subject = factor(unique(sleep$Subject)),\n                              Days = c(0:9)) |>\n  add_linpred_draws(bayes_model_sleep, ndraws = 45, seed = 14)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sleep |>\n  ggplot(aes(x = Days, y = .linpred)) +\n  stat_lineribbon(.width = c(0.80, 0.85, 0.97), alpha = 0.7) +\n  geom_point(data = sleep, aes(y = Reaction), color = \"#5D001E\") +\n  scale_fill_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_color_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_x_continuous(breaks = c(0:9), labels = c(0:9)) +\n  scale_y_continuous(breaks = seq(200, 600, 50), labels = seq(200, 600, 50)) +\n  labs(y = expression(mu), fill = \"% Credible Interval\", title = \"80%, 85% and 97% Credible Intervals\") +\n  guides(color = \"none\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\nIndividual lines:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sleep |>\n  ggplot(aes(x = Days, y = .linpred, group = interaction(.draw, Subject))) +\n  geom_line(color = \"#d1495b\") +\n  geom_point(data = sleep, aes(x = Days, y = Reaction, group = Subject), inherit.aes = F, color = \"#5D001E\") +\n  scale_x_continuous(breaks = c(0:9), labels = c(0:9)) +\n  scale_y_continuous(breaks = seq(200, 600, 50), labels = seq(200, 600, 50)) +\n  labs(y = \"Reaction Time (ms)\") +\n  guides(color = \"none\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-53-1.png){width=672}\n:::\n:::\n\n\nFaceting by Subject\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sleep |>\n  ggplot(aes(x = Days, y = .linpred)) +\n  stat_lineribbon(.width = c(0.80, 0.85, 0.99), alpha = 0.7) +\n  geom_point(data = sleep, aes(y = Reaction)) +\n  facet_wrap(~Subject) +\n  scale_fill_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_color_manual(values = c(\"#edae49\", \"#d1495b\", \"#00798c\")) +\n  scale_x_continuous(breaks = c(0:9), labels = c(0:9)) +\n  scale_y_continuous(breaks = seq(200, 600, 100), labels = seq(200, 600, 100)) +\n  labs(y = expression(mu), fill = \"% Credible Interval\", title = \"80%, 85% and 99% Credible Intervals\") +\n  guides(color = \"none\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n\nIndividual lines:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sleep |>\n  ggplot(aes(x = Days, y = .linpred, group = .draw)) +\n  geom_line(color = \"#d1495b\") +\n  geom_point(data = sleep, aes(x = Days, y = Reaction), color = \"#5D001E\",  inherit.aes = F) +\n  scale_x_continuous(breaks = c(0:9), labels = c(0:9)) +\n  scale_y_continuous(breaks = seq(200, 600, 100), labels = seq(200, 600, 100)) +\n  labs(y = \"Reation Time (ms)\") +\n  facet_wrap(~Subject) +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n\nAnother way of visualizing the uncertainty in Mixed effects models is:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sleep |>\n  ggplot(aes(x = Days, y = .linpred, group = interaction(.draw, Subject))) +\n  geom_line(aes(color = Subject)) +\n  geom_point(data = sleep, aes(x = Days, y = Reaction, group = Subject), inherit.aes = F, color = \"#5D001E\") +\n  scale_x_continuous(breaks = c(0:9), labels = c(0:9)) +\n  scale_y_continuous(breaks = seq(200, 600, 100), labels = seq(200, 600, 100)) +\n  scale_color_brewer(type = \"div\", palette = 9) +\n  labs(y = \"Reaction Time (ms)\", title = \"Subjects represented with colors\") +\n  guides(color = \"none\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-56-1.png){width=672}\n:::\n:::\n\n\nIn this kind of plot we can also observe the random effects: low variability in intercepts + moderate variability in slopes.\n\n# Generalized Linear Models (GLMs)\n\n## Not-so-professional intro to GLMs\n\n### Likelihood Function\n\nOften, our interesting research questions demand yet more complex models. Recall that ordinary regression model assumes that the dependent variable $y$ is following a normal distribution with conditional mean $\\beta_0+\\beta_1 x_1+...+\\beta_n x_n$ and variance $\\sigma^2$. Generalized linear models can assume other distributions for the outcome variable $y$, for example: if our outcome is binary we can assume it follows a Bernoulli distribution: $y \\sim Bernoulli(p)$. In this kind of model the parameter that is modeled is $p$.\n\nIn part 1 we called this the assumption of a Data Generating Process (DGP).\n\n### Link Function\n\nSometimes modeling other parameters creates other complexities: for example: the parameter $p$ is a probability, strictly bounded in $[0;1]$, but the linear predictor $\\beta_0+\\beta_1 x_1+...+\\beta_n x_n$ should be allowed to be any value in $[-\\infty;+\\infty]$. Somehow, the parameter $p$ should be mapped from it's $[0;1]$ interval to the $[-\\infty;+\\infty]$ interval. This is done with a *Link Function*:\\\n$$\nf(p)=\\beta_0+\\beta_1 x_1+...+\\beta_n x_n\n$$\n\nFor Bernoulli models this link function if often the *logit* function: $logit(p)=ln(\\frac{p}{1-p})$ - giving Logistic regression it's name.\n\nThe term $f(p)$ is often not easy or intuitive for interpretation, so the equation will be back-transformed[^1]:\n\n[^1]: Logistic regression parameters are usually interpreted on the odds ratio of $p$ instead of $p$ itself.\n\n$$\n\\frac{p}{1-p} =e^{(\\beta_0+\\beta_1 x_1+...+\\beta_n x_n)}=e^{\\beta_0} \\cdot e^{\\beta_1x_1} \\cdot... \\cdot e^{\\beta_nx_n}\n$$\n\n## Logistic Regression\n\nWe will use the *Smarket* dataset from the package `ISLR` containing information about daily percentage returns for the S&P500 index between 2001-2005.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- ISLR::Smarket\n\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Year   Lag1   Lag2   Lag3   Lag4   Lag5 Volume  Today Direction\n1 2001  0.381 -0.192 -2.624 -1.055  5.010 1.1913  0.959        Up\n2 2001  0.959  0.381 -0.192 -2.624 -1.055 1.2965  1.032        Up\n3 2001  1.032  0.959  0.381 -0.192 -2.624 1.4112 -0.623      Down\n4 2001 -0.623  1.032  0.959  0.381 -0.192 1.2760  0.614        Up\n5 2001  0.614 -0.623  1.032  0.959  0.381 1.2057  0.213        Up\n6 2001  0.213  0.614 -0.623  1.032  0.959 1.3491  1.392        Up\n```\n:::\n:::\n\n\n### Maximum Likelihood Estimation\n\nPredicting the direction of change `Direction` from returns the previous day `Lag1`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsp500 <- data |>\n  mutate(Direction = factor(Direction, levels = c(\"Down\", \"Up\")),\n         Lag1 = scale(Lag1, scale = F)[,1])\n\nlogistic_model <- glm(Direction ~ Lag1,\n                      data = sp500,\n                      family = binomial(link = \"logit\")) # 'binomial' is the DGP/likelihood function, 'link' is the link function\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(logistic_model) |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"ditwgqxxve\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ditwgqxxve table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ditwgqxxve thead, #ditwgqxxve tbody, #ditwgqxxve tfoot, #ditwgqxxve tr, #ditwgqxxve td, #ditwgqxxve th {\n  border-style: none;\n}\n\n#ditwgqxxve p {\n  margin: 0;\n  padding: 0;\n}\n\n#ditwgqxxve .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ditwgqxxve .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ditwgqxxve .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ditwgqxxve .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ditwgqxxve .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ditwgqxxve .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ditwgqxxve .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ditwgqxxve .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ditwgqxxve .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ditwgqxxve .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ditwgqxxve .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ditwgqxxve .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ditwgqxxve .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ditwgqxxve .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ditwgqxxve .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ditwgqxxve .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ditwgqxxve .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ditwgqxxve .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ditwgqxxve .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ditwgqxxve .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ditwgqxxve .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ditwgqxxve .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ditwgqxxve .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ditwgqxxve .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ditwgqxxve .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ditwgqxxve .gt_left {\n  text-align: left;\n}\n\n#ditwgqxxve .gt_center {\n  text-align: center;\n}\n\n#ditwgqxxve .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ditwgqxxve .gt_font_normal {\n  font-weight: normal;\n}\n\n#ditwgqxxve .gt_font_bold {\n  font-weight: bold;\n}\n\n#ditwgqxxve .gt_font_italic {\n  font-style: italic;\n}\n\n#ditwgqxxve .gt_super {\n  font-size: 65%;\n}\n\n#ditwgqxxve .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ditwgqxxve .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ditwgqxxve .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ditwgqxxve .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ditwgqxxve .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ditwgqxxve .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ditwgqxxve .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"z\">z</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.07</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.06</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.04, 0.18)</td>\n<td headers=\"z\" class=\"gt_row gt_center\">1.30</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.193</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Lag1</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">-0.07</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.05</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(-0.17, 0.03)</td>\n<td headers=\"z\" class=\"gt_row gt_center\">-1.40</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.160</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nBack-transforming the parameters gives:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(logistic_model, exponentiate = T) |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"fdpiazflds\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#fdpiazflds table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#fdpiazflds thead, #fdpiazflds tbody, #fdpiazflds tfoot, #fdpiazflds tr, #fdpiazflds td, #fdpiazflds th {\n  border-style: none;\n}\n\n#fdpiazflds p {\n  margin: 0;\n  padding: 0;\n}\n\n#fdpiazflds .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fdpiazflds .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fdpiazflds .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fdpiazflds .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fdpiazflds .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fdpiazflds .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fdpiazflds .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fdpiazflds .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fdpiazflds .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#fdpiazflds .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fdpiazflds .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fdpiazflds .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fdpiazflds .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fdpiazflds .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fdpiazflds .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fdpiazflds .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fdpiazflds .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fdpiazflds .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#fdpiazflds .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fdpiazflds .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fdpiazflds .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fdpiazflds .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fdpiazflds .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fdpiazflds .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fdpiazflds .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fdpiazflds .gt_left {\n  text-align: left;\n}\n\n#fdpiazflds .gt_center {\n  text-align: center;\n}\n\n#fdpiazflds .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fdpiazflds .gt_font_normal {\n  font-weight: normal;\n}\n\n#fdpiazflds .gt_font_bold {\n  font-weight: bold;\n}\n\n#fdpiazflds .gt_font_italic {\n  font-style: italic;\n}\n\n#fdpiazflds .gt_super {\n  font-size: 65%;\n}\n\n#fdpiazflds .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#fdpiazflds .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fdpiazflds .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fdpiazflds .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fdpiazflds .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fdpiazflds .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fdpiazflds .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SE\">SE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"z\">z</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"p\">p</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">1.08</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.06</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.96, 1.20)</td>\n<td headers=\"z\" class=\"gt_row gt_center\">1.30</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.193</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Lag1</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.93</td>\n<td headers=\"SE\" class=\"gt_row gt_center\">0.05</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.84, 1.03)</td>\n<td headers=\"z\" class=\"gt_row gt_center\">-1.40</td>\n<td headers=\"p\" class=\"gt_row gt_center\">0.160</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"6\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nAnd this is the logit function fitted to the data, the negative relationship between `Lag1` and market direction today can be seen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sp500 <- expand_grid(Lag1 = seq(-100, 100, 0.1))\n\nnew_data_sp500$prob <- predict(logistic_model, new_data_sp500, type = \"response\")\n\nnew_data_sp500 |>\n  ggplot(aes(x = Lag1, y = prob)) +\n  geom_smooth(method = \"glm\", method.args = list(family = \"binomial\"),\n              color = \"#5D001E\") +\n  scale_x_continuous(breaks = seq(-100, 100, 10), labels = seq(-100, 100, 10)) +\n  labs(x = \"Market return yesterday (%)\", y = \"Predicted Probability\", title = \"Predicted probability of market going Up today\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-61-1.png){width=672}\n:::\n:::\n\n\nWhen the market doesn't change - $Lag1=0$, the probability of the market going Up is $1.08$ greater then the probability of it going down. The market tends to go up!\n\nAnd, for an increase in one unit of `Lag1`, the odds ratio $\\frac {p(Direction=Up)}{p(Direction=Down)}$ decreases by a factor of $0.93$. Let's estimate the posterior!\n\n### Bayesian Estimation\n\n#### Prior elicitation\n\nThinking about the priors in a model with a link function can be tricky. So we will define them on the response level (in this case: odds ratio), and transform them to the link level (logit).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_prior(Direction ~ Lag1,\n          data = sp500,\n          family = bernoulli(link = \"logit\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                prior     class coef group resp dpar nlpar lb ub       source\n               (flat)         b                                       default\n               (flat)         b Lag1                             (vectorized)\n student_t(3, 0, 2.5) Intercept                                       default\n```\n:::\n:::\n\n\nLet's guess that a positive return yesterday predicts a positive return today. Meaning a coefficient greater then $1$ for `Lag1`. If the odds ratio is greater then $1$, the log-odds ratio is greater then $ln(1)=0$. Furthermore, the overall direction of the stock market is positive, therefore the intercept should also be greater then $1$. We define a normal marginal prior with $\\mu=1; \\sigma=3$ for each parameter:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_sp500 <- set_prior(\"normal(1, 3)\", coef = \"Lag1\") +\n  set_prior(\"normal(1, 3)\", class = \"Intercept\")\n```\n:::\n\n\nLet's fit!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_model_sp500 <- brm(Direction ~ Lag1,\n                         data = sp500,\n                         family = bernoulli(link = \"logit\"),\n                         prior = prior_sp500,\n                         iter = 2000,\n                         backend = \"cmdstanr\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(bayes_model_sp500, exponentiate = T, centrality = \"all\") |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"eetclffabx\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#eetclffabx table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#eetclffabx thead, #eetclffabx tbody, #eetclffabx tfoot, #eetclffabx tr, #eetclffabx td, #eetclffabx th {\n  border-style: none;\n}\n\n#eetclffabx p {\n  margin: 0;\n  padding: 0;\n}\n\n#eetclffabx .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#eetclffabx .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#eetclffabx .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#eetclffabx .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#eetclffabx .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#eetclffabx .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eetclffabx .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#eetclffabx .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#eetclffabx .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#eetclffabx .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#eetclffabx .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#eetclffabx .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#eetclffabx .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#eetclffabx .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#eetclffabx .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#eetclffabx .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#eetclffabx .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#eetclffabx .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#eetclffabx .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eetclffabx .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#eetclffabx .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#eetclffabx .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#eetclffabx .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eetclffabx .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#eetclffabx .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#eetclffabx .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eetclffabx .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eetclffabx .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#eetclffabx .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eetclffabx .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#eetclffabx .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#eetclffabx .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#eetclffabx .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eetclffabx .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#eetclffabx .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#eetclffabx .gt_left {\n  text-align: left;\n}\n\n#eetclffabx .gt_center {\n  text-align: center;\n}\n\n#eetclffabx .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#eetclffabx .gt_font_normal {\n  font-weight: normal;\n}\n\n#eetclffabx .gt_font_bold {\n  font-weight: bold;\n}\n\n#eetclffabx .gt_font_italic {\n  font-style: italic;\n}\n\n#eetclffabx .gt_super {\n  font-size: 65%;\n}\n\n#eetclffabx .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#eetclffabx .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#eetclffabx .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#eetclffabx .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#eetclffabx .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#eetclffabx .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#eetclffabx .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"8\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Model Summary</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Median\">Median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Mean\">Mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"MAP\">MAP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pd\">pd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Rhat\">Rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ESS\">ESS</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Median\" class=\"gt_row gt_center\">1.08</td>\n<td headers=\"Mean\" class=\"gt_row gt_center\">1.08</td>\n<td headers=\"MAP\" class=\"gt_row gt_center\">1.08</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.96, 1.20)</td>\n<td headers=\"pd\" class=\"gt_row gt_center\">89.72%</td>\n<td headers=\"Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"ESS\" class=\"gt_row gt_center\">3739.00</td></tr>\n    <tr><td headers=\"Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Lag1</td>\n<td headers=\"Median\" class=\"gt_row gt_center\">0.93</td>\n<td headers=\"Mean\" class=\"gt_row gt_center\">0.93</td>\n<td headers=\"MAP\" class=\"gt_row gt_center\">0.93</td>\n<td headers=\"95% CI\" class=\"gt_row gt_center\">(0.85, 1.03)</td>\n<td headers=\"pd\" class=\"gt_row gt_center\">91.92%</td>\n<td headers=\"Rhat\" class=\"gt_row gt_center\">0.999</td>\n<td headers=\"ESS\" class=\"gt_row gt_center\">3351.00</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"8\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\nConvergence measures looking good and the parameter estimations are very similar to the Maximum Likelihood (frequentist) estimations.\n\n#### The parameters themselves\n\n\n::: {.cell .column-screen-inset layout-nrow=\"1\"}\n\n```{.r .cell-code}\nchains_logistic <- spread_draws(bayes_model_sp500, b_Intercept, b_Lag1) |>\n  mutate(across(c(b_Intercept, b_Lag1), exp)) # transforming the distributions\n\nchains_logistic |>\n  ggplot(aes(x = b_Intercept, fill = after_stat(x < 1))) +\n  stat_slab(color = \"gray34\") +\n  scale_fill_manual(values = c(\"#00798c\", \"#d1495b\"), labels = c(\"Positive\", \"Negative\")) +\n  geom_vline(xintercept = 1, linetype = \"dashed\") +\n  labs(x = \"Intercept\", y = NULL, fill = \"Direction of effect\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-68-1.png){width=672}\n:::\n\n```{.r .cell-code}\nchains_logistic |>\n  ggplot(aes(x = b_Lag1, fill = after_stat(x < 1))) +\n  stat_slab(color = \"gray34\") +\n  scale_fill_manual(values = c(\"#00798c\", \"#d1495b\"), labels = c(\"Positive\", \"Negative\")) +\n  geom_vline(xintercept = 1, linetype = \"dashed\") +\n  labs(x = \"Lag1\", y = NULL, fill = \"Direction of effect\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-68-2.png){width=672}\n:::\n:::\n\n\n#### The line\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_sp500 |>\n  add_linpred_draws(bayes_model_sp500, ndraws = 40, seed = 140) |>\n  mutate(.linpred = exp(.linpred) / (1 + exp(.linpred))) |>\n  ggplot(aes(x = Lag1, y = .linpred)) +\n  stat_lineribbon(.width = c(0.80, 0.85, 0.90), alpha = 0.7) +\n  scale_x_continuous(breaks = seq(-100, 100, 20), labels = seq(-100, 100, 20)) +\n  scale_y_continuous(breaks = seq(0, 1, 0.1), labels = seq(0, 1, 0.1)) +\n  scale_fill_brewer() +\n  labs(y = \"Probability of market going Up\", x = \"Market return yesterday\", fill = \"Credible Interval %\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-69-1.png){width=672}\n:::\n:::\n\n\nWe will now use the `tidybayes::add_epred_draws()` function in order to extract (40) individual predictions from the posterior distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredicted_direction <- add_epred_draws(newdata = new_data_sp500, object = bayes_model_sp500, ndraws = 40, seed = 140)\n\npredicted_direction |>\n  mutate(.draw = factor(.draw)) |>\n  ggplot(aes(x = Lag1, y = .epred, group = .draw)) +\n  geom_line(color = \"#d1495b\") +\n  scale_x_continuous(breaks = seq(-100, 100, 10), labels = seq(-100, 100, 10)) +\n  labs(color = NULL, fill = NULL, x = \"Market return yesterday (%)\", y = \"Predicted Probability\", title = \"Posterior Predicted probability of market going Up\") +\n  guides(color = \"none\", fill = \"none\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-70-1.png){width=672}\n:::\n:::\n\n\nThe negative relationship is seen again, with a few odd outlier trends.\n\n## Poisson Regression - GLMer\n\nFor the final example, we'll look at a Generalized Linear Mixed effects model. That is a GLM with a hierarchical structure. Let's look at the `epilepsy` dataset from `brms`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nepilepsy <- epilepsy\n\nhead(epilepsy)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Age Base Trt patient visit count obs       zAge      zBase\n1  31   11   0       1     1     5   1  0.4249950 -0.7571728\n2  30   11   0       2     1     3   2  0.2652835 -0.7571728\n3  25    6   0       3     1     2   3 -0.5332740 -0.9444033\n4  36    8   0       4     1     4   4  1.2235525 -0.8695111\n5  22   66   0       5     1     7   5 -1.0124085  1.3023626\n6  29   27   0       6     1     5   6  0.1055720 -0.1580352\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nThe dataset contains information about patients in a randomized study for epilepsy treatment. Each patient's number of seizures was recorded 4 times during a 8-week period. We will try to predict the number of seizures from session number (should decrease overtime), and the experimental group (0 = control, 1 = Treatment).\n\nBecause the response variable in this case is the count of seizures, we will fit a *Poisson* model. In this model the estimated parameter is the rate of the Poisson process - $\\lambda$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nepilepsy |>\n  ggplot(aes(x = count)) +\n  geom_histogram(bins = 50, color = \"gray30\", fill = \"#d1495b\") +\n  labs(x = \"Number of seizures\", y = \"Count\", title = \"Looks Poisson-ish\") +\n  scale_x_continuous(breaks = seq(0, 100, 10), labels = seq(0, 100, 10)) +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-73-1.png){width=672}\n:::\n:::\n\n\n### The model\n\nBecause the rate of the Poisson process is strictly positive, the $log$ link function is used.\n\nWe start by assuming that number of seizures is Poisson distributed:\n\n$$\nCount \\sim Poisson(\\lambda)\n$$\n\nLevel 1: The (log)rate of seizures for patient $i$ in trial $j$ is:\n\n$$\nln(\\lambda_{ij})=\\beta_0+\\beta_1 \\cdot Session\n$$\n\nLevel 2:\n\n$$\n\\beta_{0i}=\\gamma_{00}+\\gamma_{01} \\cdot Treatment_i + \\tau_{0i}\n$$\n\n$$\n\\beta_{1i}=\\gamma_{10}+\\gamma_{11} \\cdot Treatment_i + \\tau_{1i}\n$$\n\n$$\n\\begin{bmatrix}\n      \\beta_0 \\cr\n      \\beta_1\n\\end{bmatrix} \\sim MVN(\\begin{bmatrix}\n                       \\gamma_{00} \\cr\n                       \\gamma_{10}\n                       \\end{bmatrix},\\begin{bmatrix}\n                                      \\tau_0^2 & \\tau_0\\tau_1\\rho_{01} \\cr\n                                      \\tau_1\\tau_0\\rho_{01} & \\tau_1^2\n                                      \\end{bmatrix})\n$$\n\nAnd $\\rho_{01}$ is the correlation coefficient between random intercepts and slopes.\n\n### Maximum Likelihood Estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\npois_model_freq <- glmer(count ~ visit * Trt + (visit | patient),\n                         data = epilepsy,\n                         family = poisson(link = \"log\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsjPlot::tab_model(pois_model_freq, transform = \"exp\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">count</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Incidence Rate Ratios</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">(Intercept)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">6.46</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">4.23&nbsp;&ndash;&nbsp;9.87</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">visit</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.96</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.87&nbsp;&ndash;&nbsp;1.05</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.331</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Trt [1]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.78</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.43&nbsp;&ndash;&nbsp;1.39</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.398</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">visit × Trt [1]</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.99</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.87&nbsp;&ndash;&nbsp;1.12</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.836</td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"font-weight:bold; text-align:left; padding-top:.8em;\">Random Effects</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&sigma;<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.19</td>\n</tr>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>00</sub> <sub>patient</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">1.03</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&tau;<sub>11</sub> <sub>patient.visit</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.02</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">&rho;<sub>01</sub> <sub>patient</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">-0.39</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">ICC</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.83</td>\n\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">N <sub>patient</sub></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">59</td>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">236</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">Marginal R<sup>2</sup> / Conditional R<sup>2</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"3\">0.021 / 0.833</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n### Bayesian Estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_prior(formula = count ~ visit * Trt + (visit | patient),\n          data = epilepsy,\n          family = poisson(link = \"log\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  prior     class       coef   group resp dpar nlpar lb ub\n                 (flat)         b                                         \n                 (flat)         b       Trt1                              \n                 (flat)         b      visit                              \n                 (flat)         b visit:Trt1                              \n                 lkj(1)       cor                                         \n                 lkj(1)       cor            patient                      \n student_t(3, 1.4, 2.5) Intercept                                         \n   student_t(3, 0, 2.5)        sd                                     0   \n   student_t(3, 0, 2.5)        sd            patient                  0   \n   student_t(3, 0, 2.5)        sd  Intercept patient                  0   \n   student_t(3, 0, 2.5)        sd      visit patient                  0   \n       source\n      default\n (vectorized)\n (vectorized)\n (vectorized)\n      default\n (vectorized)\n      default\n      default\n (vectorized)\n (vectorized)\n (vectorized)\n```\n:::\n:::\n\n\n#### Prior elicitation\n\nWe assume that seizure rate will decrease as the study progresses (negative effect of `visit`). We can also assume that this decrease will be greater for patients in the treatment group - a cross-levels interaction effect.\n\nIf each increase of one-unit in `visit` lead to a decrease of 90% in seizure count - $\\beta_{visit}=ln(0.9)=-0.11$. And if this effect will be 90% smaller in the treatment group then - $\\beta_{visitXtreatment}=ln(0.9)=-0.11$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_epilepsy <- set_prior(\"normal(-0.11, 3)\", coef = \"visit\") +\n  set_prior(\"normal(-0.11,3)\", coef = \"visit:Trt1\") +\n  set_prior(\"exponential(1)\", class = \"sd\") # setting prior on random effects' variance\n```\n:::\n\n\n#### Model estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_model_epilepsy <- brm(formula = count ~ visit * Trt + (visit | patient),\n                            data = epilepsy,\n                            family = poisson(link = \"log\"),\n                            prior = prior_epilepsy,\n                            chains = 4,\n                            cores = 4,\n                            iter = 3000,\n                            backend = \"cmdstanr\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(bayes_model_epilepsy, exponentiate = T, centrality = \"all\", effects = \"all\") |> insight::print_html()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"hmhtmjalxx\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#hmhtmjalxx table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#hmhtmjalxx thead, #hmhtmjalxx tbody, #hmhtmjalxx tfoot, #hmhtmjalxx tr, #hmhtmjalxx td, #hmhtmjalxx th {\n  border-style: none;\n}\n\n#hmhtmjalxx p {\n  margin: 0;\n  padding: 0;\n}\n\n#hmhtmjalxx .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 100%;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#hmhtmjalxx .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#hmhtmjalxx .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#hmhtmjalxx .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#hmhtmjalxx .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#hmhtmjalxx .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#hmhtmjalxx .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#hmhtmjalxx .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#hmhtmjalxx .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#hmhtmjalxx .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#hmhtmjalxx .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#hmhtmjalxx .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#hmhtmjalxx .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#hmhtmjalxx .gt_row {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#hmhtmjalxx .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmhtmjalxx .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#hmhtmjalxx .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#hmhtmjalxx .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#hmhtmjalxx .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmhtmjalxx .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#hmhtmjalxx .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmhtmjalxx .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#hmhtmjalxx .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmhtmjalxx .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#hmhtmjalxx .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#hmhtmjalxx .gt_left {\n  text-align: left;\n}\n\n#hmhtmjalxx .gt_center {\n  text-align: center;\n}\n\n#hmhtmjalxx .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#hmhtmjalxx .gt_font_normal {\n  font-weight: normal;\n}\n\n#hmhtmjalxx .gt_font_bold {\n  font-weight: bold;\n}\n\n#hmhtmjalxx .gt_font_italic {\n  font-style: italic;\n}\n\n#hmhtmjalxx .gt_super {\n  font-size: 65%;\n}\n\n#hmhtmjalxx .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#hmhtmjalxx .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#hmhtmjalxx .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#hmhtmjalxx .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#hmhtmjalxx .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#hmhtmjalxx .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#hmhtmjalxx .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"8\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Model Summary</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Parameter\">Parameter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Median\">Median</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Mean\">Mean</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"MAP\">MAP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"95% CI\">95% CI</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pd\">pd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Rhat\">Rhat</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ESS\">ESS</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Fixed Effects \">Fixed Effects </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">(Intercept)</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">6.50</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">6.48</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">6.58</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(4.17, 9.91)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1473.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">visit</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">0.95</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">0.95</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">0.95</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(0.87, 1.04)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">84.00%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.001</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">3563.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Trt1</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">0.78</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">0.78</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">0.79</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(0.42, 1.47)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">79.17%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.002</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">1461.00</td></tr>\n    <tr><td headers=\"Fixed Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">visit:Trt1</td>\n<td headers=\"Fixed Effects   Median\" class=\"gt_row gt_center\">0.99</td>\n<td headers=\"Fixed Effects   Mean\" class=\"gt_row gt_center\">0.98</td>\n<td headers=\"Fixed Effects   MAP\" class=\"gt_row gt_center\">0.99</td>\n<td headers=\"Fixed Effects   95% CI\" class=\"gt_row gt_center\">(0.87, 1.12)</td>\n<td headers=\"Fixed Effects   pd\" class=\"gt_row gt_center\">59.13%</td>\n<td headers=\"Fixed Effects   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Fixed Effects   ESS\" class=\"gt_row gt_center\">3207.00</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"8\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Random Effects \">Random Effects </th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Random Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">SD (Intercept: patient)</td>\n<td headers=\"Random Effects   Median\" class=\"gt_row gt_center\">2.83</td>\n<td headers=\"Random Effects   Mean\" class=\"gt_row gt_center\">2.86</td>\n<td headers=\"Random Effects   MAP\" class=\"gt_row gt_center\">2.79</td>\n<td headers=\"Random Effects   95% CI\" class=\"gt_row gt_center\">(2.31, 3.79)</td>\n<td headers=\"Random Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Random Effects   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Random Effects   ESS\" class=\"gt_row gt_center\">2415.00</td></tr>\n    <tr><td headers=\"Random Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">SD (visit: patient)</td>\n<td headers=\"Random Effects   Median\" class=\"gt_row gt_center\">1.17</td>\n<td headers=\"Random Effects   Mean\" class=\"gt_row gt_center\">1.17</td>\n<td headers=\"Random Effects   MAP\" class=\"gt_row gt_center\">1.16</td>\n<td headers=\"Random Effects   95% CI\" class=\"gt_row gt_center\">(1.10, 1.26)</td>\n<td headers=\"Random Effects   pd\" class=\"gt_row gt_center\">100%</td>\n<td headers=\"Random Effects   Rhat\" class=\"gt_row gt_center\">1.001</td>\n<td headers=\"Random Effects   ESS\" class=\"gt_row gt_center\">2123.00</td></tr>\n    <tr><td headers=\"Random Effects   Parameter\" class=\"gt_row gt_left\" style=\"border-right-width: 1px; border-right-style: solid; border-right-color: #d3d3d3;\">Cor (Intercept~visit: patient)</td>\n<td headers=\"Random Effects   Median\" class=\"gt_row gt_center\">0.70</td>\n<td headers=\"Random Effects   Mean\" class=\"gt_row gt_center\">0.71</td>\n<td headers=\"Random Effects   MAP\" class=\"gt_row gt_center\">0.68</td>\n<td headers=\"Random Effects   95% CI\" class=\"gt_row gt_center\">(0.52, 1.06)</td>\n<td headers=\"Random Effects   pd\" class=\"gt_row gt_center\">95.60%</td>\n<td headers=\"Random Effects   Rhat\" class=\"gt_row gt_center\">1.000</td>\n<td headers=\"Random Effects   ESS\" class=\"gt_row gt_center\">3899.00</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"8\"></td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n:::\n:::\n\n\n##### The parameters themselves\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_epilepsy <- spread_draws(bayes_model_epilepsy, b_Intercept, b_visit, b_Trt1, !!sym(\"b_visit:Trt1\"), sd_patient__Intercept, sd_patient__visit, cor_patient__Intercept__visit) |>\n  mutate(across(contains(\"b_\"), exp)) # back-transforming the regression coefficients\n```\n:::\n\n\n###### Regression coefficients\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_epilepsy |>\n  ggplot(aes(x = b_Intercept, fill = \"#d1495b\")) +\n  stat_slab(color = \"gray34\") +\n  guides(color = \"none\", fill = \"none\") +\n  labs(title = \"Intercept\", y = NULL, x = NULL) +\n  scale_x_continuous(breaks = seq(0, 15, 1), labels = seq(0, 15, 1)) +\n  blog_theme +\n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-83-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_epilepsy |>\n  select(.draw, b_visit, b_Trt1, b_visitXTrt1 = !!sym(\"b_visit:Trt1\")) |>\n  pivot_longer(cols = !.draw,\n               names_to = \"variable\") |>\n  ggplot(aes(x = value, y = variable, fill = after_stat(x > 1))) +\n  stat_slab(color = \"gray34\") +\n  geom_vline(xintercept = 1, linetype = \"dashed\") +\n  guides(color = \"none\") +\n  scale_fill_manual(values = c(\"#d1495b\", \"#00798c\"), labels = c(\"Negative\", \"Positive\")) +\n  scale_x_continuous(breaks = seq(0, 3, 0.25), labels = seq(0, 3, 0.25)) +\n  labs(title = \"Regression coefficients\", y = NULL, x = \"Change in rate of seizures\", fill = \"Direction of effect\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-84-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np_direction(bayes_model_epilepsy, parameters = \"b_\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nProbability of Direction\n\nParameter   |     pd\n--------------------\n(Intercept) |   100%\nvisit       | 84.00%\nTrt1        | 79.17%\nvisit:Trt1  | 59.13%\n```\n:::\n:::\n\n\n###### Random effects variances\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_epilepsy |>\n  select(.draw, sd_patient__Intercept, sd_patient__visit) |>\n  pivot_longer(cols = !.draw,\n               names_to = \"variable\") |>\n  ggplot(aes(x = value, y = variable, fill = \"#d1495b\")) +\n  stat_slab(color = \"gray34\") +\n  guides(color = \"none\", fill = \"none\") +\n  scale_x_continuous(breaks = seq(0, 2, 0.25), labels = seq(0, 2, 0.25)) +\n  labs(title = \"Random effects variances\", y = NULL, x = \"SD\") +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-86-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_epilepsy |>\n  ggplot(aes(x = cor_patient__Intercept__visit, fill = after_stat(x > 0))) +\n  stat_slab(color = \"gray34\") +\n  geom_vline(xintercept = 0, linetype = \"dashed\") +\n  guides(color = \"none\") +\n  scale_fill_manual(values = c(\"#d1495b\", \"#00798c\"), labels = c(\"Negative\", \"Positive\")) +\n  scale_x_continuous(breaks = seq(-1, 1, 0.2), labels = seq(-1, 1, 0.2)) +\n  labs(title = \"Correlation between random effects\", y = NULL, x = expression(r), fill = \"Direction of correlation\") +\n  blog_theme +\n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-87-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np_direction(bayes_model_epilepsy, effects = \"random\", parameters = \"cor*\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nProbability of Direction SD/Cor: patient\n\nParameter         |     pd\n--------------------------\nIntercept ~ visit | 95.60%\n```\n:::\n:::\n\n\n##### The regression line\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_epilepsy <- epilepsy |>\n  select(patient, Trt, visit) |>\n  distinct() |>\n  add_epred_draws(bayes_model_epilepsy, ndraws = 40, seed = 14)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Creating a 59-color & 14-color palettes\"}\nP59 <- Polychrome::createPalette(59, c(\"#543005\", \"#F5F5F5\", \"#003C30\"), range = c(30, 80))\nnames(P59) <- NULL\n\nP14 <- Polychrome::createPalette(14, c(\"#543005\", \"#F5F5F5\", \"#003C30\"), range = c(30, 80))\nnames(P14) <- NULL\n```\n:::\n\n\nLooking at the posterior predicted count of seizures (coloring by `patient`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_data_epilepsy |>\n  mutate(Trt = case_when(Trt == 0 ~ \"Control\",\n                         Trt == 1 ~ \"Treatment\",\n                         .default = NA)) |>\n  ggplot(aes(x = visit, y = .epred, color = patient, group = interaction(patient, .draw))) +\n  geom_line(show.legend = FALSE) +\n  scale_color_manual(values = P59) +\n  guides(color = \"none\") +\n  labs(y = \"Predicted count of seizures\", x = \"Visit\") +\n  scale_y_continuous(breaks = seq(0, 100, 10), labels = seq(0, 100, 10)) +\n  facet_wrap(~Trt) +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-91-1.png){width=672}\n:::\n:::\n\n\nKinda messy... let's choose 14 random patients and plot them:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(14)\n\ntreatment_patients <- sample(unique(epilepsy$patient[epilepsy$Trt==1]), size = 7, replace = F)\ncontrol_patients <- sample(unique(epilepsy$patient[epilepsy$Trt==0]), size = 7, replace = F)\n\nnew_data_epilepsy |>\n  filter(patient %in% c(treatment_patients, control_patients)) |>\n  mutate(Trt = case_when(Trt == 0 ~ \"Control\",\n                         Trt == 1 ~ \"Treatment\",\n                         .default = NA)) |>\n  ggplot(aes(x = visit, y = .epred, color = patient, group = interaction(patient, .draw))) +\n  geom_line(show.legend = FALSE) +\n  scale_color_manual(values = P14) +\n  guides(color = \"none\") +\n  labs(y = \"Predicted count of seizures\", x = \"Visit\") +\n  scale_y_continuous(breaks = seq(0, 100, 10), labels = seq(0, 100, 10)) +\n  facet_wrap(~Trt) +\n  blog_theme\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-92-1.png){width=672}\n:::\n:::\n\n\nThe slight overall decrease in seizure count can be seen, as well as the not-so-interesting main effect of Treatment. No visually significant interaction. Random variability in slopes of `visit` and intercept is also visible.\n\n# Conclusion\n\nIn this post I covered the types of statistical models most popular in Psychology research today, and the Bayesian way of fitting them. Together with part 1, these posts should help you include Bayesian models in your research, and make your results more robust, interesting, and ✨ pretty ✨\n\nThe next (and last?) part will be shorter and cover yet more advanced things like model performance, model comparison, prior predictive distributions and more.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}